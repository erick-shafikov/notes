JS - это интерпретируемый язык программирования (выполняется построчно):

- при парсинге код разбивается на токены и строится AST (Abstract Syntax Tree)б в котором функции и ключевые слова преобразуются в дерево. Это позволяет из готового скрипта парсить синтаксическое дерево, передавать в интерпретатор, который генерит предварительный байт-код, параллельно запускаются оптимизационные работы преобразуися в машинный код
- AST преобразуется в байт код
- JIT - оптимизирует горячие функции. Just-in-time(JIT) - компиляция и интерпретация одновременно
- выполнение

# AST

- типов узлов более 100

```js
const x = 5;

//псевдо объект в AST
AST = {
  type: "VariableDeclaration",
  kind: "const",
  declarations: [
    {
      type: "VariableDeclarator",
      id: { type: "Identifier", name: "x" },
      init: { type: "Literal", value: 5 },
    },
  ],
};
```

# JIT

Составные части:

- Inline Caching - кеширует объекты
- Hidden Classes - генерация скрытых классов
- Constant Folding - перерасчет констант

# Движок

Движок состоит из двух основных компонентов:

- Куча памяти Heap — здесь происходит распределение памяти.
- Стек вызовов — здесь находятся стековые кадры в процессе исполнения кода.

JRE - js runtime
Обеспечивает асинхронность, состоит из:

- JS Engine;
- Web API;
- Очередь обратных вызовов или очередь сообщений;
- Таблица событий;
- Цикл событий.

## Сборщик мусора

Памятью управляет Garbage Collector.

- Mark-and-Sweep - отмечаются доступные объекты
- Reference Counting - объект удаляется

можно вызывать коллбек для момента удаления из памяти

```js
const registry = new FinalizationRegistry((heldValue) => {
  // …
});

registry.register(target, "some value");
```

# Деоптимизация

Операции могут быть непредсказуемыми

- использование arguments
- try/catch и with
- смешивание разных типов в выражении

Что бы избежать

- Не использовать arguments и with. (использовать rest-параметр)
- TypedArrays - использовать при работе с большими данными
- использовать одинаковые типы
