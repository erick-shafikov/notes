# рендер элементов

- Входная точка – ReactDOM.render(), обеспечивает функционирование механизма сопоставления (reconciliation)
  При повторном вызове ReactDOM.render(), вызывается способ Reconciliation, сравниваются типы элементов и их значения. Списки определяются с помощью key. Сопоставление происходит в две фазы чтобы мы не видели подёргивания интерфейса, делает изменения в 2 фазы
- React не использует requestIdleCallback (для вызова функции в зависимости от свободных ресурсов системы), а использует библиотеку scheduler

# Методы жизненного цикла

Общий принцип

1. конструктор – вызывается один раз при построении компонента
2. если присваивать пропсы в конструкторе, то они будут доступны только при инициализации компонента, так как конструктор вызывается один раз
3. Каждый раз, при перерисовке - getDerivedStateFromProps(props, state){} – статичный метод, работает при каждом обновлении нужен при работе с пропсами и состояниями, возвращает либо новое состояние либо null, срабатывает каждый раз, отслеживает изменение пропсов
4. render’ы
5. ComponentDidMount – вызывается после отрисовки, не работает при обновлении – компонент выведен и закончил отрисовку, не работает при обновлении
6. componentDidUpdate – вызывается каждый раз при обновлении компонента, не вызывается при первом рендере

7. Монтирование
   При создании экземпляра компонента и его вставке в DOM, следующие методы вызываются в установленном порядке:
   - constructor()
   - static getDerivedStateFromProps(props, state)
   - UNSAFE_componentWillMount() - устарел
   - render()
   - componentDidMount() – подписки на события и сетевые запросы === useEffect(() => {}, [])
8. Обновление
   Обновление происходит при изменении пропсов или состояния. Следующие методы вызываются в установленном порядке при повторном рендере компонента:
   - UNSAFE_componentWillReceiveProps() – устарели
   - static getDerivedStateFromProps(props, state)
   - shouldComponentUpdate() – если вернет false, render() не вызывается, но это не предотвратит рендер дочерних компонентов и их состояния
   - UNSAFE_componentWillUpdate
   - render()
   - getSnapshotBeforeUpdate(prevStet, prevProps) – вызывается перед фиксированием, полезно для простановки прокрутки
   - componentDidUpdate(prevState, newState, this.props, this.state) – сразу после обновления === useEffect(() => {})

Каждое обновление происходит в две фазы – рендер (React указывает что должно быть на экране), коммит – React применяет эти изменения в DOM

3. Размонтирование
   componentWillUnmount() – отписка от событий, этот метод вызывается до удаления компонента из DOM === useEffect(() => { return () => {} }, [])

4. Обработка ошибок
   Следующие методы вызываются, если произошла ошибка в процессе рендеринга, методе жизненного цикла или конструкторе любого дочернего компонента.

```js
static getDerivedStateFromError(error) {
// Обновите состояние так, чтобы следующий рендер показал запасной интерфейс.
  return { hasError: true };
}

componentDidCatch()
```

component.forceUpdate(callback) – для повторного рендеринга, если он зависит от каких либо других параметров пропустит shouldComponentUpdate()

![react-lifecycle](/assets/react/react-lifecycle.png)

# повторный рендер элементов

- Изменение props
- Изменение state
- Изменился родитель (предотвращается memo)
- Контекст

| Этап                | Методы/Характеристики                                                                                                                | Описание                                                             |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------- |
| **Монтирование**    | `constructor` → `static getDerivedStateFromProps` → `render` → `componentDidMount`                                                   | Инициализация компонента.                                            |
| **Обновление**      | `New props` / `setState()` / `forceUpdate()` → `shouldComponentUpdate` → `render` → `getSnapshotBeforeUpdate` → `componentDidUpdate` | Реакция на изменения пропсов или состояния.                          |
| **Размонтирование** | `componentWillUnmount`                                                                                                               | Очистка ресурсов перед удалением компонента.                         |
| **Этап Render**     | `render`                                                                                                                             | Чистый, без побочных эффектов. Может быть приостановлен React.       |
| **Этап Pre-commit** | `getSnapshotBeforeUpdate`                                                                                                            | Позволяет читать DOM перед изменениями (например, сохранить скролл). |
| **Этап Commit**     | `componentDidMount` / `componentDidUpdate`                                                                                           | Работа с DOM, побочные эффекты, обновления.                          |
